SPIKE_NORMAL_MEM ?= 0x80000000:0x80000000
SPIKE_SECURE_MEM ?= 0x100000000:0x80000000

ifndef EXTERNAL_CONTAINER_IMG
CONTAINER_DEF=dev.def
CONTAINER_IMG=dev.sif

$(CONTAINER_IMG): $(CONTAINER_DEF)
	apptainer build -F $@ $<
else
CONTAINER_IMG=$(EXTERNAL_CONTAINER_IMG)
endif

all: $(CONTAINER_IMG)
	$(CONTAINER_IMG) --env SPIKE_NORMAL_MEM=$(SPIKE_NORMAL_MEM),SPIKE_SECURE_MEM=$(SPIKE_SECURE_MEM)

clean:
	rm -f $(CONTAINER_IMG)

.PHONY: all clean
